{% extends "base.html" %}

{% block content %}
<h1 class="h1">Games</h1>
<p class="muted">Download and tap ‚ÄúRequest ID‚Äù to receive credentials after verification.</p>

<div class="game-grid mt12">
  {% for g in games %}
  <article class="game-card">
    <div class="gc-top">
      <div class="gc-icon">
        {% if g.icon_url %}
          <img src="{{ g.icon_url }}" alt="{{ g.name }}">
        {% else %}
          <div class="icon-ph">üéÆ</div>
        {% endif %}
      </div>

      <div class="gc-info">
        <div class="gc-name" title="{{ g.name }}">{{ g.name }}</div>
        <div class="gc-desc" title="{{ g.description or '' }}">
          {{ g.description or "Download and play." }}
        </div>
      </div>

      {% if g.download_url %}
        <a class="btn btn-mini" target="_blank" rel="noopener" href="{{ g.download_url }}">Download</a>
      {% else %}
        <button class="btn btn-mini" disabled>Download</button>
      {% endif %}
    </div>

    <div class="gc-bottom">
      {% if current_user.is_authenticated %}
        <form method="post" action="{{ url_for('playerbp.request_game_account', game_id=g.id) }}">
          <button class="btn btn-primary" type="submit">Request ID</button>
        </form>
        <div class="gc-actions">
          <a class="btn btn-ghost" href="{{ url_for('short_bp.deposit_step1_clean', game_id=g.id) }}">Deposit</a>
          <a class="btn btn-ghost" href="{{ url_for('short_bp.withdraw_clean', game_id=g.id) }}">Withdraw</a>
        </div>
      {% else %}
        <a class="btn btn-primary" href="{{ url_for('auth.register_get') }}">Request ID</a>
        <div class="gc-actions">
          <a class="btn btn-ghost" href="{{ url_for('auth.login_get') }}">Deposit</a>
          <a class="btn btn-ghost" href="{{ url_for('auth.login_get') }}">Withdraw</a>
        </div>
      {% endif %}
    </div>
  </article>
  {% else %}
    <div class="empty">No games yet.</div>
  {% endfor %}
</div>
{% endblock %}