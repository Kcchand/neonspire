{% extends "base.html" %}
{% block content %}
<div class="shell" style="margin-top:14px">

  <!-- Header -->
  <div class="panel era-header" style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
    <div class="h3">Ready Accounts</div>
    <a class="btn era-back" href="{{ url_for('employeebp.employee_home') }}">← Back</a>
  </div>

  {% if not pool_available %}
    <div class="panel">
      <div class="muted">
        Ready account pool is not configured. Define a <code>ReadyAccountPool</code> model to enable this page.
      </div>
    </div>
  {% endif %}

  {% if pool_available %}
    <!-- Add form -->
    <div class="panel" style="margin-bottom:12px">
      <form method="post"
            action="{{ url_for('employeebp.ready_accounts_add') }}"
            class="era-form-grid"
            style="display:grid;grid-template-columns:220px 1fr 1fr 1fr auto;gap:8px">
        <label class="sr-only" for="game_id">Game</label>
        <select class="input" id="game_id" name="game_id" required>
          <option value="">Select game…</option>
          {% for b in buckets %}
            <option value="{{ b.game.id }}">{{ b.game.name }}</option>
          {% endfor %}
        </select>

        <label class="sr-only" for="username">Username</label>
        <input class="input" id="username" name="username" placeholder="Username" required autocomplete="off" autocapitalize="none" spellcheck="false">

        <label class="sr-only" for="password">Password</label>
        <input class="input" id="password" name="password" placeholder="Password" required autocomplete="off" autocapitalize="none" spellcheck="false">

        <label class="sr-only" for="note">Note</label>
        <input class="input" id="note" name="note" placeholder="Note (optional)" autocomplete="off">

        <button class="btn btn-primary era-add-btn" type="submit">Add</button>
      </form>

      {% if buckets|length == 0 %}
        <div class="muted" style="margin-top:8px">No active games found. Add a game first to populate this list.</div>
      {% endif %}

      <div class="muted" style="margin-top:6px;font-size:12px">
        When you add an account, the system immediately tries to fulfill any open requests for that game.
      </div>
    </div>

    <!-- Buckets by game -->
    {% for b in buckets %}
      <div class="panel" style="margin-top:12px">
        <div class="h4 era-bucket-head" style="display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap">
          <div>{{ b.game.name }}</div>
          <div class="muted">Available: <strong>{{ b.count }}</strong></div>
        </div>

        {% if b.count %}
          <!-- mobile-friendly scroll container around table -->
          <div class="era-table-wrap" style="overflow:auto">
            <div class="table era-table" style="min-width:720px">
              <div class="t-head">
                <div>Username</div>
                <div>Password</div>
                <div>Note</div>
                <div>Added</div>
                <div class="t-right">Actions</div>
              </div>

              {% for r in b.rows %}
                <div class="t-row">
                  <div class="mono era-cell-break">{{ r.username }}</div>
                  <div class="mono era-cell-break">{{ r.password }}</div>
                  <div class="era-cell-wrap">{{ r.note or '—' }}</div>
                  <div class="mono">{{ r.created_at and r.created_at.strftime('%Y-%m-%d %H:%M') or '—' }}</div>
                  <div class="t-right">
                    <form method="post"
                          action="{{ url_for('employeebp.ready_accounts_delete', row_id=r.id) }}"
                          onsubmit="return confirm('Delete this ready account?');">
                      <button class="btn btn-mini" type="submit">Delete</button>
                    </form>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% else %}
          <div class="empty">No ready accounts saved for this game.</div>
        {% endif %}
      </div>
    {% endfor %}
  {% endif %}
</div>

<style>
  /* Visually-hidden but accessible label helper (in case your global CSS doesn’t have it) */
  .sr-only{
    position:absolute !important;
    width:1px !important;
    height:1px !important;
    padding:0 !important;
    margin:-1px !important;
    overflow:hidden !important;
    clip:rect(0,0,0,0) !important;
    white-space:nowrap !important;
    border:0 !important;
  }

  /* ---------- MOBILE-ONLY IMPROVEMENTS (desktop untouched) ---------- */
  @media (max-width: 768px){
    /* Header: space better + full-width Back button if needed */
    .era-header{ gap:12px; }
    .era-back{ width:auto; }

    /* Add form stacks to single column, larger touch targets */
    .era-form-grid{
      grid-template-columns: 1fr !important;
      gap:10px !important;
    }
    .era-add-btn{
      width:100%;
      height:44px;
    }
    .era-form-grid .input{
      min-height:44px;
    }

    /* Table: allow easier horizontal scroll & better wrapping */
    .era-table-wrap{
      -webkit-overflow-scrolling: touch;
      border-radius: 10px;
    }
    .era-table{
      min-width: 640px !important; /* still scrollable, but a bit narrower for phones */
    }
    .era-cell-break{
      word-break: break-all;
    }
    .era-cell-wrap{
      white-space: normal;
      word-break: break-word;
    }

    /* Panel headings: tighter layout */
    .era-bucket-head{
      gap:10px;
    }
  }
</style>
{% endblock %}