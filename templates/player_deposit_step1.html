{% extends "base.html" %}

{% block hero %}
<div class="ticker">
  <div class="shell ticker__track">
    <span>ðŸ’° Step 1 â€” Enter amount & choose method</span>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="shell" style="margin-top:16px">
  <div class="panel">
    <div class="panel-head">
      <div class="h3">Deposit â€” Step 1</div>
    </div>

    {# Posts to playerbp.deposit_step1_post (expects: amount, method, optional game_id) #}
    <form class="form-grid" method="post" action="{{ url_for('playerbp.deposit_step1_post') }}">
      <div class="form-group">
        <label for="depAmount">Amount</label>
        <input
          id="depAmount"
          name="amount"
          type="number"
          min="1"
          step="0.01"
          placeholder="Enter amount"
          required
          style="background:var(--panel-2);border:1px solid var(--stroke);border-radius:12px;color:var(--text);padding:10px 12px"
        >
        <small class="muted">Minimum 1.00</small>
      </div>

      <div class="form-group">
        <label for="depMethod">Method</label>
        <select
          id="depMethod"
          name="method"
          required
          style="background:var(--panel-2);border:1px solid var(--stroke);border-radius:12px;color:var(--text);padding:10px 12px"
          aria-describedby="methodHelp"
        >
          <option value="CASHAPP" selected>Cash App</option>
          <option value="CHIME">Chime</option>
          <option value="CRYPTO">Crypto</option>
        </select>
        <div id="methodHelp" class="muted" style="margin-top:6px">
          Cash App: weâ€™ll process your request and then redirect you to your payment page.
        </div>
      </div>

      <div class="form-group">
        <label for="depGame">Game (optional)</label>
        <select
          id="depGame"
          name="game_id"
          style="background:var(--panel-2);border:1px solid var(--stroke);border-radius:12px;color:var(--text);padding:10px 12px"
        >
          <option value="">â€” No specific game â€”</option>
          {% for g in games %}
            <option value="{{ g.id }}" {% if preselect_game_id and preselect_game_id == g.id %}selected{% endif %}>
              {{ g.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-actions" style="grid-column:1/-1;display:flex;gap:10px;justify-content:flex-end">
        <a class="btn btn-ghost" href="{{ url_for('index') }}">Cancel</a>
        <button class="btn btn-primary" type="submit">Next</button>
      </div>
    </form>
  </div>
</div>

<script>
(function () {
  const methodEl = document.getElementById('depMethod');
  const helpEl = document.getElementById('methodHelp');
  if (!methodEl || !helpEl) return;

  const notes = {
    CASHAPP: "Cash App: weâ€™ll process your request and then redirect you to your payment page.",
    CHIME:   "Chime: after you continue, weâ€™ll show Chime instructions to complete your payment.",
    CRYPTO:  "Crypto: after you continue, weâ€™ll show wallet details / QR for your deposit."
  };

  const update = () => {
    const v = methodEl.value || "CASHAPP";
    helpEl.textContent = notes[v] || "";
  };

  methodEl.addEventListener('change', update);
  update();
})();
</script>
{% endblock %}