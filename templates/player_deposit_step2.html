{% extends "base.html" %}

{% block hero %}
<div class="ticker">
  <div class="shell ticker__track">
    <span>ðŸ“¥ Step 2 â€” Pay using {{ method.capitalize() }} & attach proof</span>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="shell" style="margin-top:16px">

  <div class="panel">
    <div class="panel-head">
      <div class="h3">Deposit â€” Step 2</div>
      <div class="muted">
        Amount: <strong>${{ amount }}</strong>
        {% if game %} â€¢ Game: <strong>{{ game.name }}</strong>{% endif %}
        â€¢ Method: <strong>{{ method.capitalize() }}</strong>
      </div>
    </div>

    <div class="method-row">
      {% if method == 'CRYPTO' %}
        <div class="method">
          <div class="method-title">Crypto</div>
          {% if settings and settings.crypto_wallet_text %}
            <div class="muted">Wallet: {{ settings.crypto_wallet_text }}</div>
          {% endif %}
          {% if settings and settings.crypto_qr_url %}
            <img class="qr" src="{{ settings.crypto_qr_url }}" alt="Crypto QR">
          {% endif %}
        </div>
      {% else %}
        <div class="method">
          <div class="method-title">Chime</div>
          {% if settings and settings.chime_handle %}
            <div class="muted">Handle: {{ settings.chime_handle }}</div>
          {% endif %}
          {% if settings and settings.chime_qr_url %}
            <img class="qr" src="{{ settings.chime_qr_url }}" alt="Chime QR">
          {% endif %}
        </div>
      {% endif %}
    </div>

    <!-- File upload form -->
    <form class="form-grid" method="post" action="{{ url_for('playerbp.deposit_submit') }}"
          enctype="multipart/form-data" style="margin-top:14px">
      <input type="hidden" name="amount" value="{{ amount }}">
      <input type="hidden" name="method" value="{{ method }}">
      <input type="hidden" name="game_id" value="{{ game.id if game else '' }}">

      <!-- New: direct image upload -->
      <div class="form-group" style="grid-column:1/-1">
        <label for="proofFile">Upload Proof/Screenshot (PNG/JPG/WEBP)</label>
        <input id="proofFile" name="proof_file" type="file" accept=".png,.jpg,.jpeg,.webp">
        <div class="muted" style="margin-top:4px">Attach your payment screenshot (preferred).</div>
      </div>

      <!-- Optional proof URL kept -->
      <div class="form-group" style="grid-column:1/-1">
        <label for="proofUrl">Payment Proof (URL)</label>
        <input id="proofUrl" name="proof_url" type="url" placeholder="Paste a link to your payment proof (optional)">
      </div>

      <div class="form-actions" style="grid-column:1/-1;display:flex;gap:10px;justify-content:flex-end">
        <a class="btn btn-ghost" href="{{ url_for('playerbp.deposit_step1', game_id=(game.id if game else None)) }}">Back</a>
        <button class="btn btn-primary" type="submit">Proceed</button>
      </div>
    </form>
  </div>

</div>
{% endblock %}