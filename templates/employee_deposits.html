{% extends "base.html" %}
{% block content %}
<div class="card card-glass">
  <div class="between">
    <h1 class="h1">Deposits</h1>
    <form method="get" class="inline-form">
      <select name="status" class="input">
        {% for st in ['PENDING','RECEIVED','LOADED','REJECTED'] %}
          <option value="{{ st }}" {% if status==st %}selected{% endif %}>{{ st }}</option>
        {% endfor %}
      </select>
      <input class="input" name="q" placeholder="Search noteâ€¦" value="{{ q or '' }}" />
      <button class="btn btn-ghost" type="submit">Filter</button>
    </form>
  </div>

  <table class="tbl mt12">
    <thead>
      <tr>
        <th>ID</th><th>User</th><th>Amount</th><th>Status</th><th>Updated</th><th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for d in items %}
      <tr>
        <td class="mono">#{{ d.id }}</td>
        <td class="mono">{{ d.user_id }}</td>
        <td>{{ d.amount }}</td>
        <td>{{ d.status }}</td>
        <td class="mono">{{ (d.updated_at or d.created_at).strftime('%Y-%m-%d %H:%M') }}</td>
        <td>
          <form method="post" action="{{ url_for('employeebp.deposit_mark', dep_id=d.id) }}" class="row gap8">
            <button class="btn btn-ghost" name="action" value="received" {% if d.status!='PENDING' %}disabled{% endif %}>Mark Received</button>
            <button class="btn btn-primary" name="action" value="load" {% if d.status not in ['PENDING','RECEIVED'] %}disabled{% endif %}>
              Load (+{{ (s.bonus_percent if s else 0) or 0 }}%)
            </button>
            <button class="btn btn-ghost" name="action" value="reject" {% if d.status in ['LOADED','REJECTED'] %}disabled{% endif %}>Reject</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="6" class="muted">No items.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}