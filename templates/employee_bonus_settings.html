{% extends "base.html" %}

{% block content %}
<style>
    .settings-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .settings-header {
        margin-bottom: 30px;
        border-bottom: 2px solid var(--stroke, #2a2e37);
        padding-bottom: 15px;
    }
    
    .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .settings-card {
        background: var(--panel-bg, #1a1d28);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--stroke, #2a2e37);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .settings-card h3 {
        margin-top: 0;
        margin-bottom: 20px;
        color: var(--text-primary, #ffffff);
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .settings-card h3 i {
        font-size: 20px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-secondary, #a0aec0);
        font-weight: 500;
    }
    
    .form-control {
        width: 100%;
        padding: 10px 15px;
        background: var(--input-bg, #2a2e37);
        border: 1px solid var(--input-border, #4a5568);
        border-radius: 8px;
        color: var(--text-primary, #ffffff);
        font-size: 14px;
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--primary, #4fd1c7);
        box-shadow: 0 0 0 3px rgba(79, 209, 199, 0.1);
    }
    
    .help-text {
        font-size: 12px;
        color: var(--text-muted, #718096);
        margin-top: 5px;
    }
    
    .btn-save {
        background: linear-gradient(135deg, #4fd1c7, #38b2ac);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-save:hover {
        background: linear-gradient(135deg, #38b2ac, #319795);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(79, 209, 199, 0.2);
    }
    
    .btn-secondary {
        background: var(--btn-secondary-bg, #4a5568);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        background: var(--btn-secondary-hover, #2d3748);
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    
    .stat-card {
        background: var(--panel-bg, #1a1d28);
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        border: 1px solid var(--stroke, #2a2e37);
    }
    
    .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary, #4fd1c7);
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 12px;
        color: var(--text-secondary, #a0aec0);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .alert-success {
        background: rgba(72, 187, 120, 0.1);
        border: 1px solid rgba(72, 187, 120, 0.3);
        color: #48bb78;
    }
    
    .alert-error {
        background: rgba(245, 101, 101, 0.1);
        border: 1px solid rgba(245, 101, 101, 0.3);
        color: #f56565;
    }
    
    .alert-info {
        background: rgba(66, 153, 225, 0.1);
        border: 1px solid rgba(66, 153, 225, 0.3);
        color: #4299e1;
    }
    
    .bonus-types {
        margin-top: 30px;
    }
    
    .bonus-type-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }
    
    .bonus-type-item {
        background: var(--panel-bg, #1a1d28);
        border-radius: 8px;
        padding: 15px;
        border: 1px solid var(--stroke, #2a2e37);
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .bonus-type-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
    }
    
    .bonus-type-content {
        flex: 1;
    }
    
    .bonus-type-name {
        font-weight: 600;
        color: var(--text-primary, #ffffff);
        margin-bottom: 3px;
    }
    
    .bonus-type-desc {
        font-size: 12px;
        color: var(--text-secondary, #a0aec0);
    }
    
    .settings-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--stroke, #2a2e37);
    }
    
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }
    
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--input-bg, #4a5568);
        transition: .4s;
        border-radius: 34px;
    }
    
    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
        background-color: var(--primary, #4fd1c7);
    }
    
    input:checked + .toggle-slider:before {
        transform: translateX(26px);
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }
    
    @media (max-width: 768px) {
        .settings-grid {
            grid-template-columns: 1fr;
        }
        
        .form-row {
            grid-template-columns: 1fr;
        }
        
        .settings-actions {
            flex-direction: column;
        }
        
        .settings-actions button {
            width: 100%;
        }
    }
</style>

<div class="settings-container">
    <!-- Header -->
    <div class="settings-header">
        <h1 style="margin: 0; color: var(--text-primary, #ffffff);">üéÅ Bonus Settings</h1>
        <p style="margin-top: 10px; color: var(--text-secondary, #a0aec0);">
            Configure bonus percentages, rules, and settings for your platform
        </p>
    </div>

    <!-- Alerts -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {% if category == 'success' %}
                        <i class="fas fa-check-circle"></i>
                    {% elif category == 'error' %}
                        <i class="fas fa-exclamation-circle"></i>
                    {% else %}
                        <i class="fas fa-info-circle"></i>
                    {% endif %}
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Stats Overview - SIMPLIFIED VERSION -->
    <div class="settings-card">
        <h3><i class="fas fa-chart-bar"></i> Bonus Statistics</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ bonus_settings.signup_percentage if bonus_settings else 100 }}%</div>
                <div class="stat-label">Sign-Up Bonus</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ bonus_settings.regular_percentage if bonus_settings else 50 }}%</div>
                <div class="stat-label">Regular Bonus</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${{ "%.2f"|format(bonus_settings.signup_max_amount if bonus_settings else 100.0) }}</div>
                <div class="stat-label">Max Sign-Up</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${{ "%.2f"|format(bonus_settings.regular_max_amount if bonus_settings else 50.0) }}</div>
                <div class="stat-label">Max Regular</div>
            </div>
        </div>
    </div>

    <!-- Settings Grid - SIMPLIFIED FOR YOUR BONUS SETTINGS -->
    <div class="settings-grid">
        <!-- Sign-Up Bonus Settings -->
        <div class="settings-card">
            <h3><i class="fas fa-user-plus"></i> Sign-Up Bonus Settings</h3>
            <form method="POST" action="{{ url_for('employeebp.update_bonus_settings') }}">
                <div class="form-group">
                    <label for="signup_active">Sign-Up Bonus Enabled</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label class="toggle-switch">
                            <input type="checkbox" 
                                   id="signup_active" 
                                   name="signup_active" 
                                   {{ 'checked' if (bonus_settings and bonus_settings.signup_active) else '' }}>
                            <span class="toggle-slider"></span>
                        </label>
                        <span>{{ 'Enabled' if (bonus_settings and bonus_settings.signup_active) else 'Disabled' }}</span>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="signup_percentage">Bonus Percentage</label>
                        <input type="number" 
                               id="signup_percentage" 
                               name="signup_percentage" 
                               class="form-control" 
                               value="{{ bonus_settings.signup_percentage if bonus_settings else 100 }}" 
                               min="0" 
                               max="500" 
                               step="1">
                        <div class="help-text">0-500%</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="signup_max_amount">Maximum Bonus</label>
                        <input type="number" 
                               id="signup_max_amount" 
                               name="signup_max_amount" 
                               class="form-control" 
                               value="{{ bonus_settings.signup_max_amount if bonus_settings else 100.0 }}" 
                               min="0" 
                               step="0.01">
                        <div class="help-text">Maximum bonus amount</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="signup_min_deposit">Minimum Deposit</label>
                        <input type="number" 
                               id="signup_min_deposit" 
                               name="signup_min_deposit" 
                               class="form-control" 
                               value="{{ bonus_settings.signup_min_deposit if bonus_settings else 5.0 }}" 
                               min="0" 
                               step="0.01">
                        <div class="help-text">Minimum deposit for bonus</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="signup_wagering">Wagering Requirement</label>
                        <input type="number" 
                               id="signup_wagering" 
                               name="signup_wagering" 
                               class="form-control" 
                               value="{{ bonus_settings.signup_wagering if bonus_settings else 30 }}" 
                               min="1" 
                               step="1">
                        <div class="help-text">X times wagering</div>
                    </div>
                </div>
        </div>

        <!-- Regular Bonus Settings -->
        <div class="settings-card">
            <h3><i class="fas fa-redo"></i> Regular Bonus Settings</h3>
                <div class="form-group">
                    <label for="regular_active">Regular Bonus Enabled</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label class="toggle-switch">
                            <input type="checkbox" 
                                   id="regular_active" 
                                   name="regular_active" 
                                   {{ 'checked' if (bonus_settings and bonus_settings.regular_active) else '' }}>
                            <span class="toggle-slider"></span>
                        </label>
                        <span>{{ 'Enabled' if (bonus_settings and bonus_settings.regular_active) else 'Disabled' }}</span>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="regular_percentage">Bonus Percentage</label>
                        <input type="number" 
                               id="regular_percentage" 
                               name="regular_percentage" 
                               class="form-control" 
                               value="{{ bonus_settings.regular_percentage if bonus_settings else 50 }}" 
                               min="0" 
                               max="500" 
                               step="1">
                        <div class="help-text">0-500%</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="regular_max_amount">Maximum Bonus</label>
                        <input type="number" 
                               id="regular_max_amount" 
                               name="regular_max_amount" 
                               class="form-control" 
                               value="{{ bonus_settings.regular_max_amount if bonus_settings else 50.0 }}" 
                               min="0" 
                               step="0.01">
                        <div class="help-text">Maximum bonus amount</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="regular_min_deposit">Minimum Deposit</label>
                        <input type="number" 
                               id="regular_min_deposit" 
                               name="regular_min_deposit" 
                               class="form-control" 
                               value="{{ bonus_settings.regular_min_deposit if bonus_settings else 10.0 }}" 
                               min="0" 
                               step="0.01">
                        <div class="help-text">Minimum deposit for bonus</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="regular_wagering">Wagering Requirement</label>
                        <input type="number" 
                               id="regular_wagering" 
                               name="regular_wagering" 
                               class="form-control" 
                               value="{{ bonus_settings.regular_wagering if bonus_settings else 25 }}" 
                               min="1" 
                               step="1">
                        <div class="help-text">X times wagering</div>
                    </div>
                </div>
                
                <button type="submit" class="btn-save">
                    <i class="fas fa-save"></i> Save All Bonus Settings
                </button>
            </form>
        </div>
    </div>

    <!-- Bonus Information -->
    <div class="bonus-types">
        <h3 style="color: var(--text-primary, #ffffff); margin-bottom: 20px;">Bonus Information</h3>
        <div class="bonus-type-list">
            <div class="bonus-type-item">
                <div class="bonus-type-icon" style="background: rgba(79, 209, 199, 0.1); color: #4fd1c7;">
                    <i class="fas fa-user-plus"></i>
                </div>
                <div class="bonus-type-content">
                    <div class="bonus-type-name">Sign-Up Bonus</div>
                    <div class="bonus-type-desc">One-time bonus for first deposit</div>
                </div>
            </div>
            
            <div class="bonus-type-item">
                <div class="bonus-type-icon" style="background: rgba(237, 137, 54, 0.1); color: #ed8936;">
                    <i class="fas fa-redo"></i>
                </div>
                <div class="bonus-type-content">
                    <div class="bonus-type-name">Regular Bonus</div>
                    <div class="bonus-type-desc">Bonus on every deposit</div>
                </div>
            </div>
            
            <div class="bonus-type-item">
                <div class="bonus-type-icon" style="background: rgba(246, 173, 85, 0.1); color: #f6ad55;">
                    <i class="fas fa-dice"></i>
                </div>
                <div class="bonus-type-content">
                    <div class="bonus-type-name">Wagering Requirements</div>
                    <div class="bonus-type-desc">Play-through requirements before withdrawal</div>
                </div>
            </div>
            
            <div class="bonus-type-item">
                <div class="bonus-type-icon" style="background: rgba(72, 187, 120, 0.1); color: #48bb78;">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="bonus-type-content">
                    <div class="bonus-type-name">Auto-Applied</div>
                    <div class="bonus-type-desc">Bonuses are applied automatically</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="settings-actions">
        <a href="{{ url_for('employeebp.employee_home') }}" class="btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        
        <a href="{{ url_for('employeebp.deposits_list') }}" class="btn-secondary">
            <i class="fas fa-money-bill-wave"></i> View Deposits
        </a>
        
        <button type="submit" form="bonusSettingsForm" class="btn-save">
            <i class="fas fa-save"></i> Save All Changes
        </button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle toggle switches
        const toggleSwitches = document.querySelectorAll('.toggle-switch input');
        toggleSwitches.forEach(switchInput => {
            const span = switchInput.parentElement.querySelector('span:not(.toggle-slider)');
            if (span) {
                // Update label on change
                switchInput.addEventListener('change', function() {
                    span.textContent = this.checked ? 'Enabled' : 'Disabled';
                });
            }
        });
        
        // Form validation
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            form.addEventListener('submit', function(e) {
                const numberInputs = form.querySelectorAll('input[type="number"]');
                let isValid = true;
                
                numberInputs.forEach(input => {
                    if (input.hasAttribute('min') || input.hasAttribute('max')) {
                        const value = parseFloat(input.value);
                        const min = parseFloat(input.getAttribute('min')) || -Infinity;
                        const max = parseFloat(input.getAttribute('max')) || Infinity;
                        
                        if (isNaN(value) || value < min || value > max) {
                            isValid = false;
                            input.style.borderColor = '#f56565';
                        } else {
                            input.style.borderColor = '';
                        }
                    }
                });
                
                if (!isValid) {
                    e.preventDefault();
                    alert('Please check your inputs. Some values are out of range.');
                }
            });
        });
        
        // Real-time validation
        const numberInputs = document.querySelectorAll('input[type="number"]');
        numberInputs.forEach(input => {
            input.addEventListener('input', function() {
                if (this.hasAttribute('min') || this.hasAttribute('max')) {
                    const value = parseFloat(this.value);
                    const min = parseFloat(this.getAttribute('min')) || -Infinity;
                    const max = parseFloat(this.getAttribute('max')) || Infinity;
                    
                    if (!isNaN(value) && value >= min && value <= max) {
                        this.style.borderColor = '#48bb78';
                    } else {
                        this.style.borderColor = '#f56565';
                    }
                }
            });
        });
        
        // Add form ID for the submit button
        const mainForm = document.querySelector('form');
        if (mainForm) {
            mainForm.id = 'bonusSettingsForm';
        }
    });
</script>
{% endblock %}